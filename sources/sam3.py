import datetime
import json
from query_utils import get_data_grafana, get_str_lucene_query




query = "data.vo:cms  AND data.dst_experiment_site:T3_US_PuertoRico AND data.status:CRITICAL"


cmssst_index = {"name": "monit_prod_sam3_enr_*", "id": "9677"}

now_datetime = datetime.datetime.now()
yesterday_datetime = now_datetime - datetime.timedelta(hours=1)
max_time = round(datetime.datetime.timestamp(now_datetime)) * 1000
min_time = round(datetime.datetime.timestamp(yesterday_datetime)) * 1000


clean_str_query = get_str_lucene_query(cmssst_index['name'], min_time, max_time, query)
response = json.loads(get_data_grafana(cmssst_index['id'], clean_str_query).text.encode('utf8'))

print(response)






















































































































